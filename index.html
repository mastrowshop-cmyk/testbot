<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì¶ –î–æ—Å—Ç–∞–≤–∫–∞ –Ø–∫—É—Ç—Å–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
        }
        
        .header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .user-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 10px;
            display: inline-block;
            font-size: 14px;
            color: #666;
        }
        
        /* –í–∫–ª–∞–¥–∫–∏ */
        .tabs {
            display: flex;
            background: #f1f3f4;
            border-radius: 12px;
            padding: 5px;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 12px 15px;
            cursor: pointer;
            border-radius: 10px;
            font-weight: 500;
            white-space: nowrap;
            min-width: 80px;
        }
        
        .tab.active {
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        /* –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        /* –§–æ—Ä–º—ã */
        .form-group {
            margin-bottom: 15px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            margin-top: 5px;
        }
        
        input:focus, select:focus {
            border-color: #667eea;
            outline: none;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            color: white;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* –°–ø–∏—Å–∫–∏ */
        .list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .list-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }
        
        .status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            float: right;
        }
        
        .status-waiting {
            background: #FF9800;
            color: white;
        }
        
        .status-ready {
            background: #4CAF50;
            color: white;
        }
        
        .status-china {
            border-left-color: #f44336;
        }
        
        .status-ussuriysk {
            border-left-color: #2196F3;
        }
        
        .status-yakutsk {
            border-left-color: #4CAF50;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .alert-success {
            background: #e8f5e9;
            color: #2E7D32;
            border-left: 5px solid #4CAF50;
        }
        
        .alert-error {
            background: #ffebee;
            color: #d32f2f;
            border-left: 5px solid #f44336;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                min-width: 70px;
                padding: 10px;
                font-size: 14px;
            }
            
            button {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <h1>üì¶ –î–æ—Å—Ç–∞–≤–∫–∞ –Ø–∫—É—Ç—Å–∫</h1>
            <div class="user-info" id="userInfo">
                –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...
            </div>
            <div id="userRole" style="margin-top: 10px;"></div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs" id="tabsContainer">
            <div class="tab active" onclick="switchTab('search')">üîç –ü–æ–∏—Å–∫</div>
            <div class="tab" onclick="switchTab('my')">üì¶ –ú–æ–∏</div>
            <div class="tab" onclick="switchTab('operator')">üë®‚Äçüíº –û–ø–µ—Ä–∞—Ç–æ—Ä</div>
            <div class="tab" onclick="switchTab('admin')">üëë –ê–¥–º–∏–Ω</div>
            <div class="tab" onclick="switchTab('status')">üìä –°—Ç–∞—Ç—É—Å</div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ 1: –ü–æ–∏—Å–∫ -->
        <div id="searchTab" class="tab-content active">
            <div class="card">
                <h3>üîç –û—Ç—Å–ª–µ–¥–∏—Ç—å –ø–æ—Å—ã–ª–∫—É</h3>
                <div class="form-group">
                    <input type="text" id="trackInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä...">
                </div>
                <button class="btn-primary" onclick="searchTrack()">–ù–∞–π—Ç–∏</button>
                <button class="btn-warning" onclick="clearSearch()">–û—á–∏—Å—Ç–∏—Ç—å</button>
                
                <div id="searchResult" style="margin-top: 20px;"></div>
            </div>
            
            <div class="card">
                <h3>üìç –î–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é</h3>
                <div class="form-group">
                    <input type="text" id="manualTrack" placeholder="–¢—Ä–µ–∫-–Ω–æ–º–µ—Ä">
                </div>
                <div class="form-group">
                    <select id="manualLocation">
                        <option value="china">–ö–∏—Ç–∞–π üá®üá≥</option>
                        <option value="ussuriysk">–£—Å—Å—É—Ä–∏–π—Å–∫ üá∑üá∫</option>
                        <option value="yakutsk">–Ø–∫—É—Ç—Å–∫ üá∑üá∫</option>
                    </select>
                </div>
                <button class="btn-success" onclick="addManualPackage()">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ 2: –ú–æ–∏ –ø–æ—Å—ã–ª–∫–∏ -->
        <div id="myTab" class="tab-content">
            <div class="card">
                <h3>üì¶ –ú–æ–∏ –ø–æ—Å—ã–ª–∫–∏ (<span id="packageCount">0</span>)</h3>
                <button class="btn-primary" onclick="loadMyPackages()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                <div id="myPackagesList" class="list" style="margin-top: 15px;">
                    –ó–∞–≥—Ä—É–∑–∫–∞...
                </div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ 3: –û–ø–µ—Ä–∞—Ç–æ—Ä -->
        <div id="operatorTab" class="tab-content">
            <div class="card">
                <h3>‚öñÔ∏è –í–∑–≤–µ—Å–∏—Ç—å –ø–æ—Å—ã–ª–∫—É</h3>
                <div class="form-group">
                    <input type="text" id="weighTrack" placeholder="–¢—Ä–µ–∫-–Ω–æ–º–µ—Ä">
                </div>
                <div class="form-group">
                    <input type="number" id="weighWeight" placeholder="–í–µ—Å (–∫–≥)" step="0.1" min="0.1">
                </div>
                <button class="btn-success" onclick="weighPackage()">–í–∑–≤–µ—Å–∏—Ç—å</button>
            </div>
            
            <div class="card">
                <h3>‚è≥ –û–∂–∏–¥–∞—é—Ç –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏—è (<span id="pendingCount">0</span>)</h3>
                <div id="pendingPackages" class="list">
                    –ó–∞–≥—Ä—É–∑–∫–∞...
                </div>
            </div>
            
            <div class="card">
                <h3>‚úÖ –ì–æ—Ç–æ–≤—ã–µ –ø–æ—Å—ã–ª–∫–∏</h3>
                <div id="readyPackages" class="list">
                    –ó–∞–≥—Ä—É–∑–∫–∞...
                </div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ 4: –ê–¥–º–∏–Ω -->
        <div id="adminTab" class="tab-content">
            <div class="card">
                <h3>üí∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–µ–Ω</h3>
                <div class="form-group">
                    <label>–ö–∏—Ç–∞–π (‚ÇΩ/–∫–≥):</label>
                    <input type="number" id="priceChina" value="500">
                </div>
                <div class="form-group">
                    <label>–£—Å—Å—É—Ä–∏–π—Å–∫ (‚ÇΩ/–∫–≥):</label>
                    <input type="number" id="priceUssuriysk" value="300">
                </div>
                <div class="form-group">
                    <label>–Ø–∫—É—Ç—Å–∫ (‚ÇΩ/–∫–≥):</label>
                    <input type="number" id="priceYakutsk" value="150">
                </div>
                <div class="form-group">
                    <label>–î–æ–ø. —Å–±–æ—Ä (‚ÇΩ):</label>
                    <input type="number" id="priceExtra" value="150">
                </div>
                <button class="btn-success" onclick="savePrices()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–Ω—ã</button>
            </div>
            
            <div class="card">
                <h3>üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π</h3>
                <button class="btn-warning" onclick="reloadData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                <button class="btn-primary" onclick="exportData()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                <button class="btn-danger" onclick="clearAllData()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
                
                <div id="adminStats" style="margin-top: 15px;"></div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ 5: –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã -->
        <div id="statusTab" class="tab-content">
            <div class="card">
                <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h3>
                <div id="systemStats">
                    <p>üïí <strong>–í—Ä–µ–º—è:</strong> <span id="currentTime">-</span></p>
                    <p>üë§ <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</strong> <span id="userCount">-</span></p>
                    <p>üì¶ <strong>–í—Å–µ–≥–æ –ø–æ—Å—ã–ª–æ–∫:</strong> <span id="totalPackages">-</span></p>
                    <p>‚è≥ <strong>–û–∂–∏–¥–∞—é—Ç:</strong> <span id="waitingCount">-</span></p>
                    <p>‚úÖ <strong>–ì–æ—Ç–æ–≤—ã:</strong> <span id="completedCount">-</span></p>
                </div>
                <button class="btn-primary" onclick="updateStats()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            
            <div class="card">
                <h3>üìÅ –§–∞–π–ª—ã Excel</h3>
                <div id="fileStatus">
                    <p>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤...</p>
                </div>
                <button class="btn-warning" onclick="checkFiles()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã</button>
            </div>
        </div>
        
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div id="notificationArea" style="margin-top: 20px;"></div>
        
        <!-- –§—É—Ç–µ—Ä -->
        <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; color: #666;">
            <p>üì¶ –î–æ—Å—Ç–∞–≤–∫–∞ –Ø–∫—É—Ç—Å–∫ ‚Ä¢ –≥. –Ø–∫—É—Ç—Å–∫ ‚Ä¢ –ü–Ω-–ü—Ç 9:00-18:00</p>
            <p style="font-size: 12px;">–í–µ—Ä—Å–∏—è 1.0 ‚Ä¢ <span id="version">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç -->
    <script>
        // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        let tg = null;
        let user = null;
        let userRole = 'client';
        let packages = [];
        let users = [];
        let prices = {
            china: 500,
            ussuriysk: 300,
            yakutsk: 150,
            extra: 150
        };
        
        // ID –∞–¥–º–∏–Ω–æ–≤ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
        const ADMIN_IDS = [1079406651, 7668402802];
        const OPERATOR_IDS = [];
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', function() {
            // Telegram Web App
            tg = window.Telegram.WebApp;
            tg.expand();
            tg.enableClosingConfirmation();
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            user = tg.initDataUnsafe.user;
            if (user) {
                document.getElementById('userInfo').innerHTML = 
                    `üë§ ${user.first_name} ${user.last_name || ''}<br><small>ID: ${user.id}</small>`;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–æ–ª—å
                if (ADMIN_IDS.includes(user.id)) {
                    userRole = 'admin';
                    document.getElementById('userRole').innerHTML = 
                        '<span style="color: #FF9800; font-weight: bold;">üëë –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†</span>';
                } else if (OPERATOR_IDS.includes(user.id)) {
                    userRole = 'operator';
                    document.getElementById('userRole').innerHTML = 
                        '<span style="color: #2196F3; font-weight: bold;">üë®‚Äçüíº –û–ü–ï–†–ê–¢–û–†</span>';
                } else {
                    userRole = 'client';
                    document.getElementById('userRole').innerHTML = 
                        '<span style="color: #4CAF50; font-weight: bold;">üë§ –ö–õ–ò–ï–ù–¢</span>';
                }
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
                updateTabVisibility();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                loadFromStorage();
                loadMyPackages();
                updateStats();
                updateTime();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
                setInterval(updateTime, 60000);
                setInterval(updateStats, 30000);
            }
        });
        
        // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–ö–õ–ê–î–ö–ê–ú–ò ==========
        function updateTabVisibility() {
            const tabs = document.getElementById('tabsContainer');
            const tabElements = tabs.querySelectorAll('.tab');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
            tabElements.forEach(tab => {
                const tabName = tab.textContent;
                if (tabName.includes('üë®‚Äçüíº') && userRole !== 'operator' && userRole !== 'admin') {
                    tab.style.display = 'none';
                }
                if (tabName.includes('üëë') && userRole !== 'admin') {
                    tab.style.display = 'none';
                }
            });
        }
        
        function switchTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —Ç–∞–±–æ–≤
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ç–∞–±
            document.querySelectorAll('.tab').forEach(tab => {
                if (tab.textContent.includes(getTabIcon(tabName))) {
                    tab.classList.add('active');
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
            if (tabName === 'my') {
                loadMyPackages();
            } else if (tabName === 'operator') {
                loadPendingPackages();
                loadReadyPackages();
            } else if (tabName === 'status') {
                updateStats();
            }
        }
        
        function getTabIcon(tabName) {
            switch(tabName) {
                case 'search': return 'üîç';
                case 'my': return 'üì¶';
                case 'operator': return 'üë®‚Äçüíº';
                case 'admin': return 'üëë';
                case 'status': return 'üìä';
                default: return '';
            }
        }
        
        // ========== –ü–û–ò–°–ö –ü–û–°–´–õ–ö–ò ==========
        function searchTrack() {
            const track = document.getElementById('trackInput').value.trim().toUpperCase();
            if (!track) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä', 'error');
                return;
            }
            
            const resultDiv = document.getElementById('searchResult');
            resultDiv.innerHTML = '<div class="alert">üîç –ò—â–µ–º –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö...</div>';
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π API)
            setTimeout(() => {
                const locations = ['–ö–∏—Ç–∞–π üá®üá≥', '–£—Å—Å—É—Ä–∏–π—Å–∫ üá∑üá∫', '–Ø–∫—É—Ç—Å–∫ üá∑üá∫'];
                const statuses = ['–æ–∂–∏–¥–∞–µ—Ç', '–≤ –ø—É—Ç–∏', '–≥–æ—Ç–æ–≤–æ'];
                const randomLoc = locations[Math.floor(Math.random() * locations.length)];
                const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                
                resultDiv.innerHTML = `
                    <div class="alert alert-success">
                        <h4>‚úÖ –ü–û–°–´–õ–ö–ê –ù–ê–ô–î–ï–ù–ê!</h4>
                        <p><strong>–¢—Ä–µ–∫:</strong> ${track}</p>
                        <p><strong>–ú–µ—Å—Ç–æ:</strong> ${randomLoc}</p>
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${randomStatus}</p>
                        <p><strong>–î–∞—Ç–∞ –ø–æ–∏—Å–∫–∞:</strong> ${new Date().toLocaleString('ru-RU')}</p>
                        <button class="btn-success" onclick="addPackage('${track}', '${randomLoc}')" style="margin-top: 10px;">
                            üì¶ –î–æ–±–∞–≤–∏—Ç—å –≤ –º–æ–∏ –ø–æ—Å—ã–ª–∫–∏
                        </button>
                    </div>
                `;
            }, 1000);
        }
        
        function clearSearch() {
            document.getElementById('trackInput').value = '';
            document.getElementById('searchResult').innerHTML = '';
        }
        
        // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–°–´–õ–ö–ê–ú–ò ==========
        function addPackage(track, location) {
            const newPackage = {
                id: Date.now(),
                track: track,
                location: location,
                owner: user.id,
                ownerName: user.first_name + ' ' + (user.last_name || ''),
                status: '–æ–∂–∏–¥–∞–µ—Ç',
                weight: null,
                price: null,
                addedDate: new Date().toISOString(),
                weighedDate: null,
                notes: ''
            };
            
            packages.push(newPackage);
            saveToStorage();
            
            showNotification(`–ü–æ—Å—ã–ª–∫–∞ ${track} –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ "–ú–æ–∏ –ø–æ—Å—ã–ª–∫–∏"`, 'success');
            loadMyPackages();
        }
        
        function addManualPackage() {
            const track = document.getElementById('manualTrack').value.trim().toUpperCase();
            const location = document.getElementById('manualLocation').value;
            
            if (!track) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä', 'error');
                return;
            }
            
            let locationName = '';
            switch(location) {
                case 'china': locationName = '–ö–∏—Ç–∞–π üá®üá≥'; break;
                case 'ussuriysk': locationName = '–£—Å—Å—É—Ä–∏–π—Å–∫ üá∑üá∫'; break;
                case 'yakutsk': locationName = '–Ø–∫—É—Ç—Å–∫ üá∑üá∫'; break;
            }
            
            addPackage(track, locationName);
            document.getElementById('manualTrack').value = '';
        }
        
        function loadMyPackages() {
            const userPackages = packages.filter(p => p.owner === user.id);
            const listDiv = document.getElementById('myPackagesList');
            const countSpan = document.getElementById('packageCount');
            
            countSpan.textContent = userPackages.length;
            
            if (userPackages.length === 0) {
                listDiv.innerHTML = '<div class="alert">üì≠ –£ –≤–∞—Å –Ω–µ—Ç –ø–æ—Å—ã–ª–æ–∫</div>';
                return;
            }
            
            listDiv.innerHTML = userPackages.map(pkg => `
                <div class="list-item status-${pkg.location.includes('–ö–∏—Ç–∞–π') ? 'china' : 
                                               pkg.location.includes('–£—Å—Å—É—Ä–∏–π—Å–∫') ? 'ussuriysk' : 'yakutsk'}">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <strong>${pkg.track}</strong>
                        <span class="status ${pkg.status === '–≥–æ—Ç–æ–≤–æ' ? 'status-ready' : 'status-waiting'}">
                            ${pkg.status === '–≥–æ—Ç–æ–≤–æ' ? '‚úÖ –ì–û–¢–û–í–ê' : 'üü° –û–ñ–ò–î–ê–ï–¢'}
                        </span>
                    </div>
                    <p>üìç ${pkg.location}</p>
                    <p>üìÖ ${new Date(pkg.addedDate).toLocaleDateString('ru-RU')}</p>
                    ${pkg.weight ? `<p>‚öñÔ∏è ${pkg.weight} –∫–≥ ‚Ä¢ üí∞ ${pkg.price} ‚ÇΩ</p>` : ''}
                    ${pkg.weighedDate ? `<p><small>–í–∑–≤–µ—à–µ–Ω–∞: ${new Date(pkg.weighedDate).toLocaleString('ru-RU')}</small></p>` : ''}
                    <div style="margin-top: 10px;">
                        <button class="btn-primary" style="padding: 5px 10px; font-size: 12px;" 
                                onclick="viewPackageDetails(${pkg.id})">üìã –î–µ—Ç–∞–ª–∏</button>
                        ${pkg.status !== '–≥–æ—Ç–æ–≤–æ' ? 
                          `<button class="btn-warning" style="padding: 5px 10px; font-size: 12px;" 
                                  onclick="markAsReady(${pkg.id})">‚úÖ –ì–æ—Ç–æ–≤–æ</button>` : ''}
                        <button class="btn-danger" style="padding: 5px 10px; font-size: 12px;" 
                                onclick="deletePackage(${pkg.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }
        
        // ========== –§–£–ù–ö–¶–ò–ò –û–ü–ï–†–ê–¢–û–†–ê ==========
        function loadPendingPackages() {
            const pending = packages.filter(p => p.status === '–æ–∂–∏–¥–∞–µ—Ç');
            const listDiv = document.getElementById('pendingPackages');
            const countSpan = document.getElementById('pendingCount');
            
            countSpan.textContent = pending.length;
            
            if (pending.length === 0) {
                listDiv.innerHTML = '<div class="alert">‚úÖ –ù–µ—Ç –ø–æ—Å—ã–ª–æ–∫, –æ–∂–∏–¥–∞—é—â–∏—Ö –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏—è</div>';
                return;
            }
            
            listDiv.innerHTML = pending.map(pkg => `
                <div class="list-item">
                    <strong>${pkg.track}</strong><br>
                    <small>üë§ ${pkg.ownerName}</small><br>
                    üìç ${pkg.location}<br>
                    üìÖ ${new Date(pkg.addedDate).toLocaleDateString('ru-RU')}<br>
                    <div class="form-group" style="margin-top: 10px;">
                        <input type="number" id="weight_${pkg.id}" placeholder="–í–µ—Å (–∫–≥)" 
                               step="0.1" min="0.1" style="width: calc(100% - 90px); display: inline-block;">
                        <button class="btn-success" onclick="weighSinglePackage(${pkg.id})" 
                                style="width: 80px; padding: 8px;">–í–∑–≤–µ—Å–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }
        
        function loadReadyPackages() {
            const ready = packages.filter(p => p.status === '–≥–æ—Ç–æ–≤–æ');
            const listDiv = document.getElementById('readyPackages');
            
            if (ready.length === 0) {
                listDiv.innerHTML = '<div class="alert">üì≠ –ù–µ—Ç –≥–æ—Ç–æ–≤—ã—Ö –ø–æ—Å—ã–ª–æ–∫</div>';
                return;
            }
            
            listDiv.innerHTML = ready.map(pkg => `
                <div class="list-item status-ready">
                    <strong>${pkg.track}</strong><br>
                    <small>üë§ ${pkg.ownerName}</small><br>
                    üìç ${pkg.location}<br>
                    ‚öñÔ∏è ${pkg.weight} –∫–≥ ‚Ä¢ üí∞ ${pkg.price} ‚ÇΩ<br>
                    üìÖ ${new Date(pkg.weighedDate).toLocaleDateString('ru-RU')}
                </div>
            `).join('');
        }
        
        function weighPackage() {
            const track = document.getElementById('weighTrack').value.trim().toUpperCase();
            const weight = parseFloat(document.getElementById('weighWeight').value);
            
            if (!track || !weight || weight <= 0) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ', 'error');
                return;
            }
            
            const pkg = packages.find(p => p.track === track && p.status === '–æ–∂–∏–¥–∞–µ—Ç');
            if (!pkg) {
                showNotification('–ü–æ—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ —É–∂–µ –≤–∑–≤–µ—à–µ–Ω–∞', 'error');
                return;
            }
            
            // –†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã
            let pricePerKg = prices.yakutsk;
            if (pkg.location.includes('–ö–∏—Ç–∞–π')) pricePerKg = prices.china;
            if (pkg.location.includes('–£—Å—Å—É—Ä–∏–π—Å–∫')) pricePerKg = prices.ussuriysk;
            
            const price = (weight * pricePerKg) + prices.extra;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            pkg.weight = weight;
            pkg.price = Math.round(price);
            pkg.status = '–≥–æ—Ç–æ–≤–æ';
            pkg.weighedDate = new Date().toISOString();
            
            saveToStorage();
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            document.getElementById('weighTrack').value = '';
            document.getElementById('weighWeight').value = '';
            
            showNotification(`–ü–æ—Å—ã–ª–∫–∞ ${track} –≤–∑–≤–µ—à–µ–Ω–∞: ${weight} –∫–≥, —Ü–µ–Ω–∞: ${Math.round(price)} ‚ÇΩ`, 'success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–∫–∏
            loadPendingPackages();
            loadReadyPackages();
            loadMyPackages();
        }
        
        function weighSinglePackage(packageId) {
            const weightInput = document.getElementById(`weight_${packageId}`);
            const weight = parseFloat(weightInput.value);
            
            if (!weight || weight <= 0) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–µ—Å', 'error');
                return;
            }
            
            const pkg = packages.find(p => p.id === packageId);
            if (!pkg) return;
            
            // –†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã
            let pricePerKg = prices.yakutsk;
            if (pkg.location.includes('–ö–∏—Ç–∞–π')) pricePerKg = prices.china;
            if (pkg.location.includes('–£—Å—Å—É—Ä–∏–π—Å–∫')) pricePerKg = prices.ussuriysk;
            
            const price = (weight * pricePerKg) + prices.extra;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            pkg.weight = weight;
            pkg.price = Math.round(price);
            pkg.status = '–≥–æ—Ç–æ–≤–æ';
            pkg.weighedDate = new Date().toISOString();
            
            saveToStorage();
            weightInput.value = '';
            
            showNotification(`–ü–æ—Å—ã–ª–∫–∞ ${pkg.track} –≤–∑–≤–µ—à–µ–Ω–∞!`, 'success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–∫–∏
            loadPendingPackages();
            loadReadyPackages();
            loadMyPackages();
        }
        
        // ========== –§–£–ù–ö–¶–ò–ò –ê–î–ú–ò–ù–ê ==========
        function savePrices() {
            prices = {
                china: parseFloat(document.getElementById('priceChina').value) || 500,
                ussuriysk: parseFloat(document.getElementById('priceUssuriysk').value) || 300,
                yakutsk: parseFloat(document.getElementById('priceYakutsk').value) || 150,
                extra: parseFloat(document.getElementById('priceExtra').value) || 150
            };
            
            localStorage.setItem('delivery_prices', JSON.stringify(prices));
            showNotification('–¶–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
        }
        
        function reloadData() {
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Excel —Ñ–∞–π–ª–æ–≤
            showNotification('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...', 'info');
            
            setTimeout(() => {
                showNotification('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã (–∏–º–∏—Ç–∞—Ü–∏—è)', 'success');
                updateStats();
            }, 1500);
        }
        
        function exportData() {
            const dataStr = JSON.stringify(packages, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `–¥–æ—Å—Ç–∞–≤–∫–∞_–¥–∞–Ω–Ω—ã–µ_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ JSON', 'success');
        }
        
        function clearAllData() {
            if (confirm('‚ö†Ô∏è –í–´ –£–í–ï–†–ï–ù–´?\n\n–≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ (–ø–æ—Å—ã–ª–∫–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π).')) {
                packages = [];
                users = [];
                localStorage.removeItem('delivery_packages');
                localStorage.removeItem('delivery_users');
                
                showNotification('–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã', 'success');
                loadMyPackages();
                updateStats();
            }
        }
        
        // ========== –°–¢–ê–¢–£–° –°–ò–°–¢–ï–ú–´ ==========
        function updateStats() {
            const total = packages.length;
            const waiting = packages.filter(p => p.status === '–æ–∂–∏–¥–∞–µ—Ç').length;
            const completed = packages.filter(p => p.status === '–≥–æ—Ç–æ–≤–æ').length;
            
            document.getElementById('totalPackages').textContent = total;
            document.getElementById('waitingCount').textContent = waiting;
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('userCount').textContent = users.length > 0 ? users.length : '1 (—Ç–µ–∫—É—â–∏–π)';
        }
        
        function updateTime() {
            document.getElementById('currentTime').textContent = 
                new Date().toLocaleTimeString('ru-RU');
            document.getElementById('version').textContent = 
                `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}`;
        }
        
        function checkFiles() {
            const statusDiv = document.getElementById('fileStatus');
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤
            const fakeFiles = [
                {name: '–∫–∏—Ç–∞–π_–ø–æ—Å—ã–ª–∫–∏.xlsx', status: '‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω', rows: '~1500 —Å—Ç—Ä–æ–∫'},
                {name: '—É—Å—Å—É—Ä–∏–π—Å–∫_–±–∞–∑–∞.xlsx', status: '‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω', rows: '~800 —Å—Ç—Ä–æ–∫'},
                {name: '—è–∫—É—Ç—Å–∫_—Å–∫–ª–∞–¥.xlsx', status: '‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω', rows: '~1200 —Å—Ç—Ä–æ–∫'}
            ];
            
            statusDiv.innerHTML = fakeFiles.map(file => `
                <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                    <strong>${file.name}</strong><br>
                    –°—Ç–∞—Ç—É—Å: ${file.status}<br>
                    –î–∞–Ω–Ω—ã–µ: ${file.rows}
                </div>
            `).join('');
        }
        
        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function showNotification(message, type = 'info') {
            const notificationArea = document.getElementById('notificationArea');
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'error' ? 'error' : 'success'}`;
            notification.innerHTML = message;
            
            notificationArea.appendChild(notification);
            
            // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
        
        function saveToStorage() {
            localStorage.setItem('delivery_packages', JSON.stringify(packages));
            localStorage.setItem('delivery_users', JSON.stringify(users));
        }
        
        function loadFromStorage() {
            const savedPackages = localStorage.getItem('delivery_packages');
            const savedUsers = localStorage.getItem('delivery_users');
            const savedPrices = localStorage.getItem('delivery_prices');
            
            if (savedPackages) packages = JSON.parse(savedPackages);
            if (savedUsers) users = JSON.parse(savedUsers);
            if (savedPrices) prices = JSON.parse(savedPrices);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è —Ü–µ–Ω –≤ —Ñ–æ—Ä–º–µ –∞–¥–º–∏–Ω–∞
            if (prices) {
                document.getElementById('priceChina').value = prices.china;
                document.getElementById('priceUssuriysk').value = prices.ussuriysk;
                document.getElementById('priceYakutsk').value = prices.yakutsk;
                document.getElementById('priceExtra').value = prices.extra;
            }
        }
        
        function viewPackageDetails(packageId) {
            const pkg = packages.find(p => p.id === packageId);
            if (!pkg) return;
            
            alert(`
üì¶ –î–µ—Ç–∞–ª–∏ –ø–æ—Å—ã–ª–∫–∏:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–¢—Ä–µ–∫: ${pkg.track}
–ú–µ—Å—Ç–æ: ${pkg.location}
–í–ª–∞–¥–µ–ª–µ—Ü: ${pkg.ownerName}
–°—Ç–∞—Ç—É—Å: ${pkg.status}
–í–µ—Å: ${pkg.weight || '–Ω–µ –≤–∑–≤–µ—à–µ–Ω–∞'} –∫–≥
–¶–µ–Ω–∞: ${pkg.price || '–Ω–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞'} ‚ÇΩ
–î–æ–±–∞–≤–ª–µ–Ω–∞: ${new Date(pkg.addedDate).toLocaleString('ru-RU')}
–í–∑–≤–µ—à–µ–Ω–∞: ${pkg.weighedDate ? new Date(pkg.weighedDate).toLocaleString('ru-RU') : '–Ω–µ—Ç'}
            `);
        }
        
        function markAsReady(packageId) {
            const pkg = packages.find(p => p.id === packageId);
            if (!pkg) return;
            
            pkg.status = '–≥–æ—Ç–æ–≤–æ';
            pkg.weighedDate = new Date().toISOString();
            
            // –ê–≤—Ç–æ—Ä–∞—Å—á–µ—Ç –≤–µ—Å–∞ –∏ —Ü–µ–Ω—ã
            pkg.weight = (Math.random() * 5 + 0.5).toFixed(2);
            
            let pricePerKg = prices.yakutsk;
            if (pkg.location.includes('–ö–∏—Ç–∞–π')) pricePerKg = prices.china;
            if (pkg.location.includes('–£—Å—Å—É—Ä–∏–π—Å–∫')) pricePerKg = prices.ussuriysk;
            
            pkg.price = Math.round((parseFloat(pkg.weight) * pricePerKg) + prices.extra);
            
            saveToStorage();
            loadMyPackages();
            
            showNotification(`–ü–æ—Å—ã–ª–∫–∞ ${pkg.track} –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –≥–æ—Ç–æ–≤–∞—è`, 'success');
        }
        
        function deletePackage(packageId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø–æ—Å—ã–ª–∫—É?')) {
                packages = packages.filter(p => p.id !== packageId);
                saveToStorage();
                loadMyPackages();
                updateStats();
                showNotification('–ü–æ—Å—ã–ª–∫–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
            }
        }
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï ==========
        // –£–∂–µ –≤ DOMContentLoaded
    </script>
</body>
</html>
